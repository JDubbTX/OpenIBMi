---
layout: post
title:  "RPG CiCd - Part 2 - Local Development Setup"
date:   2023-05-14
excerpt: Building a full CiCd pipeline for ILE - Part 2 - Local ILE Development
author: john-weirich
draft: false
seo:
  title: ILE CiCd Pipeline with Gitlab - Part 2 - Local Development Setup
  description:
  image: cicd_cropped.png
images: # relative to /src/assets/images/
  feature:
  thumb: cicd_cropped.png
  align: # object-center (default) - other options at https://tailwindcss.com/docs/object-position
  height: # optional. Default = h-48 md:h-1/3
---

*This post is continued from [ILE CiCd Pipeline with Gitlab](/2023/05/08/ile-cicd-pipeline-with-gitlab).*

There are a few hurdles to overcome to achieve local RPGLE / CLLE development.  This blog post will help you though those hurdles.  The outcome is that changes you make on your local PC pushed to an IFS directory and compiled, while also being synchronized with online source/version control, such as Github, Bitbucket, GitLab, etc.

{% wrap "px-2 mt-8 rounded-lg pb-2 border border-yellow-300 bg-gray-200" %}

To begin, we will not be working on the IBM i.  Instead, we will focus on getting your local PC able to talk to a remote repository hosted in GitLab.  Windows steps are pictured, but the process isn't any different on a Mac.

{% endwrap %}

## VSCODE and Git setup

1. Install VSCODE

   Go to the [Visual Studio Code download page](https://code.visualstudio.com/download) and install it on your machine.  Once installed, it will notify you when there are updates and prompt you to update it, quite seamlessly.   It usually only takes a few seconds.

2. Install GIT (local)

   VSCODE automatically prompts you to download and install it the first time you click on the the **source control** view in the activity bar.  After you finish the GIT install and reload VSCODE, you should see the **Open Folder** and **Clone Repository** buttons in the **source control** view.

   ![Downloading GIT](/assets/images/VSCODE_Install_GIT.gif) 

   ![Install GIT](/assets/images/VSCODE_Install_GIT_2.gif)

3. Configure Git

   The first time you use Git, you must configure some settings.  Open up a bash terminal in VSCODE and run the following 2 commands:

   ``` bash
   git config --global user.name "xx xxxx"
   git config --global user.email "xx.xxxx@mail.com"
   ```

   ![Configure GIT](/assets/images/Git_Config.gif)

   These settings will be used to identify you on every commit you make.

## Set up SSH keys in GitLab

We need to generate an SSH key pair on your local PC, then enter the public key in your gitlab profile.  This allows easy, secure ability to push and pull content from your PC to Gitlab.  All of the following instructions are pretty much the same if you use another SCM like Github instead of Gitlab.

1. Open up a bash prompt on your PC.  If you are in windows, you installed Git Bash when you installed Git.  You could also [install a linux distro like Ubuntu in WSL](https://ubuntu.com/tutorials/install-ubuntu-on-wsl2-on-windows-11-with-gui-support#1-overview).  Gitbash is simpler, but I recommend using WSL if you are interested in using development containers with docker.

2. run `ssh-keygen`, taking the default by pressing enter on each prompt.  Just press enter for the passphrase - you don't need one.  Once you see the randomart image for the key, a key pair was generated in your home directory.

3. Copy the contents of your id_rsa.pub file.  This is your public key that we will register in gitlab or gitlab.  You can display its contents with `cat ~/.ssh/id_rsa.pub`.  Copy the entire contents, starting with ssh-rsa, ending after the last character displayed.

4. Go into your Gitlab or Github account and register your publish ssh key.

   * [GitLab instructions](https://docs.gitlab.com/ee/user/ssh.html#add-an-ssh-key-to-your-gitlab-account)
   * [Github instructions](https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account)

   After public key registration, you will now be able to securely access the remote repository (gitlab / github) using Git over SSH.

## Install VSCODE extensions

There are a multitude of extensions available for VSCODE.  They are available to install in the [Visual Studio Code Marketplace](https://marketplace.visualstudio.com/VSCode), or you can access the same marketplace from within the VSCODE in the extensions sidebar view:
   ![Install IBM i Development Pack](/assets/images/InstallIBMiDevelopmentPack.jpg)

Here are the essential ones for IBM i development.

*  [IBM i Development Pack](https://marketplace.visualstudio.com/items?itemName=HalcyonTechLtd.ibm-i-development-pack) This will install 13 extensions, all helpful for developing on IBM i, including the Code for IBM i extension.

*  [GitLense](https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens) This gives you full visibility to your git repository, both locally and remote.

## Log in to your IBM i with the Code for IBM i extension.

You need to first [configure your Settings](/2023/05/18/VSCODE-Settings-for-IBM-i-development)

## Create a project

There are two approaches to getting a project to sync to online source control.  The easiest approach is to create a blank project online, then clone it locally.  In this tutorial, we will use gitlab, but the same concept applies if you are using Github, Bitbucket, and the like.

1. In the web browser of your choice, log into your Gitlab account and create a new project.  Think of a good name for your project.  This will end up being the directory name where the source is stored.  For this tutorial we will call it "My First IBM i Project".

![CiCd pipeline](/assets/images/Gitlab_Create_New_Project.gif)

2. Copy the project SSH clone URL and clone it

## Clone it

5. Set your deploy IFS target directory - do this in the IFS

> In the next series of steps, we will work on the IBM i development partition where source will be built.

## You need a home directory

You need to have a home directory on your development IBM i partition.  It doesn't matter how you add it, there are several ways.  If we assume you can't SSH, you can always do it with a CRTDIR command in the greenscreen.

![Please, not more greenscreen!](/assets/images/CRTDIR.png)

## Set default shell to Bash

If you haven't done it yet, follow instructions in [this link](https://ibmi-oss-docs.readthedocs.io/en/latest/troubleshooting/SETTING_BASH.html) to set Bash as your default shell.  For historical reasons, IBM i has ksh (kornshell) as the default shell.  Most folks prefer Bash. Most open source examples you find on the web use Bash.  The absolute easiest way to do it is to run the following command in ACS Run SQL Scripts tool:

```
CALL QSYS2.SET_PASE_SHELL_INFO('*CURRENT', '/QOpenSys/pkgs/bin/bash')
```

## IBM i setup.

The first work we need to do is to set up your IBM i profile for open source development.  We will make an SSH connection to the IBM i first, and then we will set up your .profile

### SSH to your IBM i

You can SSH to your IBM i development partition from a Git Bash prompt, from a WSL/Ubuntu prompt, from Windows Powershell, or from PuTTY.  Which one you use depends on which you are most comfortable with.  I typically use PuTTY, since you can save the connection details and just double click whenever you want to connect.  Quick and easy.  

As you start to spend more time in shell environments, you may find it quicker to SSH from a command line.  You might even want to use an SSH-agent manager, like the one I use - [keychain](https://linux.die.net/man/1/keychain)

The command to SSH is `ssh username@serveraddress`.  If your IBM i server uses a non-standard port, which is the case for PUB400, you must add `-p 9999` to the command, where 9999 is the SSH port number required by the server.

![SSH Options](/assets/images/2023/05/08/SSH-Options.png)

As you can see in the screenshots above, the first time you connect to a server via SSH, you will get a warning message that says something like this:

```text
The authenticity of host '[pub400.com]:2222 ([185.113.5.134]:2222)' can't be established.
ED25519 key fingerprint is SHA256:NcBw63NS/aa3kLgyEzg7TMDqp3H4D1q6CLjJfS/FyaE.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])?
```

This is completely normal the first time you connect.  You can type in `yes`, press enter, and then you be presented with 1) another warning message, 2) the server welcome message and 3) you will prompted for your password.  Enter it and press enter.  

Assuming you followed the steps on this page, including setting up SSH keys on your local machine, setting up a home directory on the IBM i partition, and setting up Bash as the default shell, you should be presented with a Bash prompt in the home directory of you IBM i partition.

It should go something like this:

```text
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[pub400.com]:2222' (ED25519) to the list of known hosts.
*********************************************
* WELCOME TO PUB400.COM - your public IBM i *
* ----------------------------------------- *
* Please take note of the following:        *
* - all access is logged                    *
* - please be polite and do not disturb     *
*   other users!                            *
* - this system is of limited support       *
* - see https://pub400.com                  *
*********************************************

-> Enter your password for Logon below:
jweirich@pub400.com's password:
-bash-5.1$
```

### Setting your IBM i PATH

What is PATH you say?  I think of the PATH environmental variable as something like a library list.  The PATH is simply a list of directories to all the commands and files that you use on a regular basis.  Like a library list, when you enter a Bash command at the bash prompt, the PATH is searched from top to bottom and if the command (or file you are trying to access) isn't found, you will get an error.  

Your IBM i user profile has a default library list defined in its **WRKUSRPRF** profile settings.  We need to do the same thing for your PATH, and that is accomplished by defining it in a special **.profile** file that goes in your home directory.  The awesome open source packages that we want to be able to use are by default installed in the **QOpenSys/pkgs/bin** IFS directory, and so that is the directory we would like to have added to our path.

Perform the following commands:

1. Run `echo PATH=/QOpenSys/pkgs/bin:\$PATH >> .profile` from your home directory
2. Run `cat .profile` to check that the **.profile** file was updated correctly
3. Run `source .profile` to execute the contents of your new .profile file
4. Run `echo $PATH` to check that the PATH environmental variable now includes **/QopenSys/pkgs/bin**

![SSH Options](/assets/images/2023/05/08/Set-Path.png)

## Git your code in shape
1. WIP

## More Setting up VSCODE
1. WIP

## Compiling code from a local repo
1. WIP
